{
  "name": "base_schema",
  "version": {
    "base_schema": "0.0.5"
  },
  "description": "This is the Objectiv base schema for the Open Analytics Taxonomy.",

  "RequiresLocationContext" : {
    "description": "A validation rule that can be applied to the Location Stack. Checks whether the given AbstractLocationContext is present and, optionally, at the required position.",
    "properties" : {
      "scope": {
        "description": "A list of AbstractLocationContexts, and optionally their positions, to check in the Location Stack.",
        "type": "array",
        "items": {
          "context": {
            "description": "The AbstractLocationContext to check in the Location Stack.",
            "type": "AbstractLocationContext"
          },
          "position": {
            "description": "[Optional] The position the given `context` should be at. Zero-based.",
            "type": "integer",
            "optional": true
          }
        }
      }
    }
  },

  "RequiresGlobalContext" : {
    "description": "A validation rule that can be applied to the Global Contexts. Checks whether the given AbstractGlobalContext is present.",
    "properties" : {
      "scope": {
        "description": "A list of AbstractGlobalContexts to check in the Global Contexts.",
        "type": "array",
        "items": {
          "context": {
            "description": "The AbstractGlobalContexts to check in the Global Contexts.",
            "type": "AbstractGlobalContext"
          }
        }
      }
    }
  },

  "UniqueContext" : {
    "description": "A validation rule that can be applied either to the Location Stack or the Global Contexts. Checks whether contexts are uniquely identified by the given `by` properties. Optionally `context` can be specified to restrict the check to a specific AbstractContext only.",
    "properties": {
      "scope": {
        "description": "[Optional] Restricts the check to a specific AbstractContext, as opposed to checking all of them.",
        "type": "array",
        "items": {
          "includeContext": {
            "description": "The AbstractContexts to include in the check.",
            "type": "array",
            "items" : {
              "type": "AbstractContext"
            },
            "optional": true
          },
          "excludeContext": {
            "description": "The AbstractContexts to exclude from the check.",
            "type": "array",
            "items" : {
              "type": "AbstractContext"
            },
            "optional": true
          },
          "by": {
            "type": "array",
            "description": "Which Context's properties to look at for comparison. Normally `_type` and `id`.",
            "items": {
              "type": "string"
            }
          }
        }
      }
    }
  },

  "MatchContextProperty" : {
    "description": "A validation rule that can be applied either to the Location Stack or the Global Contexts. Given two AbstractContexts checks whether the specified property matches.",
    "properties" : {
      "scope": {
        "description": "A list with items composed of two AbstractContexts and the property to compare between them.",
        "type": "array",
        "items": {
          "contextA": {
            "description": "The first AbstractContext to check.",
            "type": "AbstractContext"
          },
          "contextB": {
            "description": "The second AbstractContext to check.",
            "type": "AbstractContext"
          },
          "property": {
            "description": "The property to compare in the two AbstractContexts.",
            "type": "string"
          }
        }
      }
    }
  },

  "LocationStack": {
    "description": "The location stack is an ordered list (stack), that contains a hierarchy of location contexts that \ndeterministically describes where an event took place from global to specific. \nThe whole stack (list) is needed to exactly pinpoint where in the UI the event originated.",
    "type": "array",
    "items": {
      "type":"AbstractLocationContext",
      "discriminator": "_type"
    },
    "validation": {
      "description": "TODO explain the basic requirements of a valid Location Stack",
      "allowed_rules": [
        "RequiresLocationContext",
        "UniqueContext"
      ],
      "rules": [
        {
          "type": "UniqueContext",
          "scope": [
            {
              "by": ["_type", "id"]
            }
          ]
        }
      ]
    }
  },

  "GlobalContexts": {
    "description": "Global contexts add global / general information about the event. They carry information that is not \nrelated to where the Event originated (location), such as device, platform or business data.",
    "type": "array",
    "items": {
      "type":"AbstractGlobalContext",
      "discriminator":"_type"
    },
    "validation": {
      "description": "TODO explain the basic requirements of a valid Global Contexts",
      "allowed_rules": [
        "RequiresGlobalContext",
        "UniqueContext"
      ],
      "rules": [
        {
          "type": "RequiresGlobalContext",
          "scope": [
            {
              "context": "ApplicationContext"
            }
          ]
        },
        {
          "type": "UniqueContext",
          "scope": [
            {
              "excludeContexts": ["InputValueContext"],
              "by": ["_type", "id"]
            },
            {
              "includeContexts": ["InputValueContext"],
              "by": ["_type", "id", "value"]
            }
          ]
        }
      ]
    }
  },

  "events": {
    "AbstractEvent": {
      "description": "This is the abstract parent of all Events.",
      "properties":{
        "location_stack": {
          "type": "LocationStack"
        },
        "global_contexts": {
          "type": "GlobalContexts"
        },
        "_type": {
          "description": "A string literal used during serialization. Should always match the Event interface name.",
          "type": "discriminator"
        },
        "id": {
          "description": "Unique identifier for a specific instance of an event.",
          "type": "uuid"
        },
        "time": {
          "description": "Timestamp indicating when the event was generated.",
          "type": "integer"
        }
      },
      "validation": {
        "allowed_rules": [
          "RequiresLocationContext",
          "RequiresGlobalContext",
          "UniqueContext",
          "MatchContextProperty"
        ]
      }
    },
    "InteractiveEvent": {
      "description": "The parent of Events that are the direct result of a user interaction, e.g. a button click.",
      "parent": "AbstractEvent",
      "properties": {
        "location_stack": {
          "type": "LocationStack",
          "optional": false
        }
      },
      "validation": {
        "description": "TODO: explain why PathContext is validated, for example",
        "rules": [
          {
            "type": "RequiresLocationContext",
            "scope": [
              {
                "context": "RootLocationContext",
                "position": 0
              }
            ]
          },
          {
            "type": "RequiresGlobalContext",
            "scope": [
              {
                "context": "PathContext"
              }
            ]
          }
        ]
      }
    },
    "NonInteractiveEvent": {
      "description": "The parent of Events that are not directly triggered by a user action.",
      "parent": "AbstractEvent"
    },
    "ApplicationLoadedEvent": {
      "description": "A NonInteractive event that is emitted after an application (e.g. SPA) has finished loading.",
      "parent": "NonInteractiveEvent"
    },
    "FailureEvent": {
      "description": "A NonInteractiveEvent that is sent when a user action results in an error, \nlike an invalid email when sending a form.",
      "parent": "NonInteractiveEvent",
      "properties": {
        "message": {
          "description": "Failure message.",
          "type": "string"
        }
      }
    },
    "InputChangeEvent": {
      "description": "Event triggered when user input is modified.",
      "parent": "InteractiveEvent",
      "validation": {
        "rules": [
          {
            "type": "RequiresLocationContext",
            "scope": [
              {
                "context": "InputContext"
              }
            ]
          },
          {
            "type": "MatchContextProperty",
            "scope": [
              {
                "contextA": "InputContext",
                "contextB": "InputValueContext",
                "property": "id"
              }
            ]
          }
        ]
      }
    },
    "PressEvent": {
      "description": "An InteractiveEvent that is sent when a user presses on a pressable element \n(like a link, button, icon).",
      "parent": "InteractiveEvent",
      "validation": {
        "rules": [
          {
            "type": "RequiresLocationContext",
            "scope": [
              {
                "context": "PressableContext"
              }
            ]
          }
        ]
      }
    },
    "HiddenEvent": {
      "description": "A NonInteractiveEvent that's emitted after a LocationContext has become invisible.",
      "parent": "NonInteractiveEvent"
    },
    "VisibleEvent": {
      "description": "A NonInteractiveEvent that's emitted after a section LocationContext has become visible.",
      "parent": "NonInteractiveEvent"
    },
    "SuccessEvent": {
      "description": "A NonInteractiveEvent that is sent when a user action is successfully completed, \nlike sending an email form.",
      "parent": "NonInteractiveEvent",
      "properties": {
        "message": {
          "description": "Success message.",
          "type": "string"
        }
      }
    },
    "MediaEvent": {
      "description": "The parent of non-interactive events that are triggered by a media player. \nIt requires a MediaPlayerContext to detail the origin of the event.",
      "parent": "NonInteractiveEvent",
      "validation": {
        "rules": [
          {
            "type": "RequiresLocationContext",
            "scope": [
              {
                "context": "MediaPlayerContext"
              }
            ]
          }
        ]
      }
    },
    "MediaLoadEvent": {
      "description": "A MediaEvent that's emitted after a media item completes loading.",
      "parent": "MediaEvent"
    },
    "MediaPauseEvent": {
      "description": "A MediaEvent that's emitted after a media item pauses playback.",
      "parent": "MediaEvent"
    },
    "MediaStartEvent": {
      "description": "A MediaEvent that's emitted after a media item starts playback.",
      "parent": "MediaEvent"
    },
    "MediaStopEvent": {
      "description": "A MediaEvent that's emitted after a media item stops playback.",
      "parent": "MediaEvent"
    }
  },
  "contexts": {
    "AbstractContext": {
      "description": "AbstractContext defines the bare minimum properties for every Context. All Contexts inherit from it.",
      "properties": {
        "id": {
          "description":"A unique string identifier to be combined with the Context Type (`_type`) \nfor Context instance uniqueness.",
          "type": "string"
        },
        "_type": {
          "description": "A string literal used during serialization. Should always match the Context interface name.",
          "type": "discriminator"
        }
      }
    },
    "AbstractGlobalContext": {
      "description": "This is the abstract parent of all Global Contexts. Global contexts add general information to an Event.",
      "parent": "AbstractContext"
    },
    "ApplicationContext": {
      "description": "A GlobalContext describing in which app the event happens, like a website or iOS app.",
      "parent": "AbstractGlobalContext"
    },
    "CookieIdContext": {
      "description": "Global context with information needed to reconstruct a user session.",
      "parent": "AbstractGlobalContext",
      "properties": {
        "cookie_id": {
          "description": "Unique identifier from the session cookie.",
          "type": "string"
        }
      }
    },
    "HttpContext": {
      "description": "A GlobalContext describing meta information about the agent that sent the event.",
      "parent": "AbstractGlobalContext",
      "properties": {
        "referrer": {
          "description": "Full URL to HTTP referrer of the current page.",
          "type": "string"
        },
        "user_agent": {
          "description": "User-agent of the agent that sent the event.",
          "type": "string"
        },
        "remote_address": {
          "description": "(public) IP address of the agent that sent the event.",
          "type": "string",
          "optional": true
        }
      }
    },
    "InputValueContext": {
      "description": "A GlobalContext containing the value of a single input element. Multiple can be present.",
      "parent": "AbstractGlobalContext",
      "properties": {
        "value": {
          "description": "The value of the input element.",
          "type": "string"
        }
      }
    },
    "LocaleContext": {
      "description": "A GlobalContext describing the users' language (ISO 639-1) and country (ISO 3166-1 alpha-2).",
      "parent": "AbstractGlobalContext",
      "properties": {
        "language_code": {
          "description": "Case sensitive ISO 639-1 language code. E.g. en, nl, fr, de, it, etc.",
          "type": "string",
          "optional": true
        },
        "country_code": {
          "description": "Case sensitive ISO 3166-1 alpha-2 country code. E.g. US, NL, FR, DE, IT, etc.",
          "type": "string",
          "optional": true
        }
      }
    },
    "PathContext": {
      "description": "A GlobalContext describing the path where the user is when an event is sent.",
      "parent": "AbstractGlobalContext"
    },
    "SessionContext": {
      "description": "A GlobalContext describing meta information about the current session.",
      "parent": "AbstractGlobalContext",
      "properties": {
        "hit_number": {
          "description": "Hit counter relative to the current session, this event originated in.",
          "type": "integer"
        }
      }
    },
    "MarketingContext": {
      "description": "a context that captures marketing channel info, so users can do attribution, campaign \neffectiveness and other models.",
      "parent": "AbstractGlobalContext",
      "properties": {
        "source": {
          "description": "Identifies the advertiser, site, publication, etc.",
          "type": "string"
        },
        "medium": {
          "description": "Advertising or marketing medium: cpc, banner, email newsletter, etc.",
          "type": "string"
        },
        "campaign": {
          "description": "Individual campaign name, slogan, promo code, etc.",
          "type": "string"
        },
        "term": {
          "description": "[Optional] Search keywords.",
          "type": "string",
          "optional": true
        },
        "content": {
          "description": "[Optional] Used to differentiate similar content, or links within the same ad.",
          "type": "string",
          "optional": true
        },
        "source_platform": {
          "description": "[Optional] To differentiate similar content, or links within the same ad.",
          "type": "string",
          "optional": true
        },
        "creative_format": {
          "description": "[Optional] Identifies the creative used (e.g., skyscraper, banner, etc).",
          "type": "string",
          "optional": true
        },
        "marketing_tactic": {
          "description": "[Optional] Identifies the marketing tactic used (e.g., onboarding, retention, acquisition etc).",
          "type": "string",
          "optional": true
        }
      }
    },
    "IdentityContext": {
      "description": "A Global Context to track the identity of users across sessions, platforms, devices. Multiple can be present.\nThe `id` field is used to specify the scope of identification e.g. backend, md5(email), supplier_cookie, etc.\nThe `value` field should contain the unique identifier within that scope.",
      "parent": "AbstractGlobalContext",
      "properties": {
        "value": {
          "description": "The unique identifier for this user/group/entity within the scope defined by `id`.",
          "type": "string"
        }
      }
    },
    "AbstractLocationContext": {
      "description": "AbstractLocationContext are the abstract parents of all Location Contexts.\nLocation Contexts are meant to describe where an event originated from in the visual UI.",
      "parent": "AbstractContext"
    },
    "InputContext": {
      "description": "A Location Context that describes an element that accepts user input, i.e. a form field.",
      "parent": "AbstractLocationContext"
    },
    "PressableContext": {
      "description": "A Location Context that describes an interactive element (like a link, button, icon), \nthat the user can press and will trigger an Interactive Event.",
      "parent": "AbstractLocationContext"
    },
    "LinkContext": {
      "description": "A PressableContext that contains a destination (href).",
      "parent": "PressableContext",
      "properties": {
        "href": {
          "description": "URL (href) the link points to.",
          "type": "string"
        }
      }
    },
    "RootLocationContext": {
      "description": "A Location Context that uniquely represents the top-level UI location of the user.",
      "parent": "AbstractLocationContext"
    },
    "ExpandableContext": {
      "description": "A Location Context that describes a section of the UI that can expand & collapse.",
      "parent": "AbstractLocationContext"
    },
    "MediaPlayerContext": {
      "description": "A Location Context that describes a section of the UI containing a media player.",
      "parent": "AbstractLocationContext"
    },
    "NavigationContext": {
      "description": "A Location Context that describes a section of the UI containing navigational elements, for example a menu.",
      "parent": "AbstractLocationContext"
    },
    "OverlayContext": {
      "description": "A Location Context that describes a section of the UI that represents an overlay, i.e. a Modal.",
      "parent": "AbstractLocationContext"
    },
    "ContentContext": {
      "description": "A Location Context that describes a logical section of the UI that contains other Location Contexts. \nEnabling Data Science to analyze this section specifically.",
      "parent": "AbstractLocationContext"
    }
  }
}
